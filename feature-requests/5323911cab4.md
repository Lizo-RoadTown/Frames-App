# FRAMES System: Complete Architecture Briefing

## Document Purpose

This briefing provides the full scope of the FRAMES system evolution. You (the implementing agent) should read this completely before making any architectural decisions. The system is being built iteratively, but you need to understand the end state to make good decisions now.

---

## Table of Contents

1. [Current State](#current-state)
2. [Target State](#target-state)
3. [Core Concepts](#core-concepts)
4. [Data Architecture](#data-architecture)
5. [System Components](#system-components)
6. [Integration Points](#integration-points)
7. [The Iterative Discovery Process](#the-iterative-discovery-process)
8. [Implementation Sequence](#implementation-sequence)
9. [Decision Points Requiring Human Input](#decision-points-requiring-human-input)
10. [Technical Constraints](#technical-constraints)

---

## Current State

### What Exists

**File: `index.html`** - A single-page visualization tool with:
- Form-based creation of teams, faculty, projects
- Interface definition with bond types (codified-strong, institutional-weak, etc.)
- Fixed energy-loss values (5%, 15%, 35%, 60%)
- Molecular visualization with animated energy particles
- Static metrics (energy flow efficiency, decomposition risk)

**Data structures** (in JavaScript):
```javascript
let teams = [];        // {id, discipline, lifecycle, name, size, experience, description}
let faculty = [];      // {id, name, role, description}
let projects = [];     // {id, name, type, description}
let interfaces = [];   // {id, from, to, interfaceType, bondType, energyLoss}
```

### Limitations of Current State

- Single organization only
- Fixed categories and coefficients
- No persistence (data lost on refresh)
- No real-time data input
- No learning or adaptation
- Visualization is display-only (not bidirectional)

---

## Target State

### End Vision

A **multi-university research instrument** that:

1. **Connects 8 universities** with shared visibility into cross-institutional interfaces
2. **Captures real-time data** from Discord interactions
3. **Discovers patterns** through iterative observation
4. **Evolves its own schema** as new categories and layers are identified
5. **Learns coefficients** through embedded AI analyzing outcomes
6. **Enables bidirectional interaction** where visualization changes modify underlying data
7. **Supports two modes**: Operations (per-university dashboard) and Research (cross-university analysis)

### Key Architectural Shifts

| Aspect | Current | Target |
|--------|---------|--------|
| Scope | 1 university | 8 universities |
| Data persistence | None (JS arrays) | Database with versioning |
| Categories | Fixed (4 bond types) | Extensible, discovered from data |
| Coefficients | Hardcoded | Learned by AI |
| Data input | Manual forms | Manual + Discord automation |
| Visualization | Display only | Bidirectional (drag = edit) |
| Updates | Static | Real-time sync across users |

---

## Core Concepts

### Nearly Decomposable Architecture (NDA)

The theoretical foundation. Complex systems are composed of:
- **Modules**: Semi-autonomous units (teams, universities)
- **Interfaces**: Connection points between modules
- **Couplings**: Strength of connections (strong internally, weaker externally)

### Six NDA Diagnostic Dimensions

Every interface is assessed across these dimensions:

1. **Actor autonomy**: Degree of independent operation; conflicting objectives
2. **Partitioned knowledge domains**: Knowledge siloing; specialization gaps
3. **Emergent/ambiguous outputs**: Shifting or undefined goals
4. **Temporal misalignment**: Timing differences (academic calendar vs. project needs)
5. **Integration cost**: Effort required to coordinate
6. **Coupling degradation**: Weakening of relationships over time

### Knowledge Type Risk

Base risk classification for each interface:
- **Institutional knowledge**: High risk (tacit, held by individuals, lost when they leave)
- **Codified knowledge**: Low risk (documented, transferable)
- **Mixed**: Contains both types

### The Matrix

A directed graph where:
- **Nodes** = teams, faculty, projects, external partners (across 8 universities)
- **Edges** = directed interfaces showing knowledge/task flow

Example edges:
```
CADENCE.Software ‚Üí CADENCE.MissionOps (code handoff)
Gov.Director ‚Üí JPL (formal reporting)
PROVES.Ines ‚Üí CADENCE.CommsRF (cross-university collaboration)
```

### Layers and Categories

Each edge is assessed through multiple **layers**. Each layer contains **categories**.

**Critical concept**: Categories are NOT fixed. They are discovered through observation of Discord data and outcomes. The system must support adding new layers and categories without code changes.

### Iterative Discovery

The research methodology:
```
Observe data ‚Üí Notice patterns ‚Üí Create category ‚Üí Apply across edges ‚Üí 
Notice new patterns ‚Üí May reveal new layer ‚Üí Repeat
```

Example:
- Initial category: "after" (transfer happens late)
- Observation: Some "after" transfers succeed, others fail
- Discovery: New category "rushed" (late AND compressed time)
- Further observation: "rushed" appears across multiple dimensions
- Discovery: New layer "transfer_quality" with categories: rushed, deliberate, iterative

---

## Data Architecture

### Node Schema

```javascript
{
  node_id: "CADENCE.Software",
  university_id: "CADENCE",
  node_type: "team",  // team | faculty | project | external
  
  // Type-specific attributes
  attributes: {
    discipline: "software",
    lifecycle_stage: "established",  // incoming | established | outgoing
    size: 5,
    experience_months: 18,
    description: "Flight software development team"
  },
  
  // Position for visualization (user-draggable, persisted)
  position: {
    x: 450,
    y: 320
  },
  
  metadata: {
    created_at: "2025-09-01T00:00:00Z",
    updated_at: "2025-11-17T10:30:00Z",
    created_by: "user_123"
  }
}
```

### Edge Schema (Extensible Assessment)

```javascript
{
  edge_id: "edge_456",
  source_node: "PROVES.Ines",
  target_node: "CADENCE.CommsRF",
  source_university: "PROVES",
  target_university: "CADENCE",
  is_cross_university: true,
  
  // Version tracking for schema evolution
  schema_version: 3,
  last_updated: "2025-11-17T10:30:00Z",
  
  // Extensible layer assessments
  layers: [
    {
      layer_id: "knowledge_type",
      categories_applied: ["institutional"],
      confidence: "established",  // established | provisional | emergent
      severity: "high",
      raw_observations: "No documentation exists for protocol decisions",
      discovered_from: "user_input",
      assessed_at: "2025-11-15T00:00:00Z",
      assessed_by: "user_123"
    },
    {
      layer_id: "temporal_misalignment",
      categories_applied: ["after", "rushed"],
      confidence: "emergent",
      severity: "high",
      modifiers: ["compressed_timeline", "end_of_semester"],
      raw_observations: "Discord shows handoff messages in final 3 days",
      discovered_from: "discord_scrape_2025-11",
      assessed_at: "2025-11-17T00:00:00Z",
      assessed_by: "system_auto"
    }
    // Additional layers added dynamically as discovered
  ],
  
  // Outcome events (for AI learning)
  outcomes: [
    {
      outcome_id: "outcome_789",
      date: "2025-11-10T00:00:00Z",
      type: "failure",  // failure | success | neutral
      failure_type: "repeated_work",  // taxonomy TBD
      severity: "moderate",  // low | moderate | high | critical
      description: "CADENCE rebuilt protocol parser unaware PROVES had working version",
      reported_by: "user_456",
      verified: true
    }
  ],
  
  // AI-computed values (updated by learning engine)
  computed: {
    risk_score: 0.73,
    bond_strength: 0.27,
    energy_loss_percent: 42,
    confidence_interval: [0.65, 0.81],
    last_computed: "2025-11-17T06:00:00Z",
    model_version: "v0.3.2"
  }
}
```

### Layer Registry (Schema Evolution Tracking)

```javascript
{
  layer_id: "temporal_misalignment",
  display_name: "Temporal Misalignment",
  nda_dimension: true,  // Is this one of the 6 NDA dimensions?
  description: "Timing differences between source and target modules",
  
  categories: [
    {
      category_id: "before",
      status: "provisional",
      first_observed: "2025-09-01",
      discovered_from: "initial_framework",
      definition: "Transfer occurs proactively, ahead of need",
      edge_count: 12
    },
    {
      category_id: "after",
      status: "provisional",
      first_observed: "2025-09-01",
      discovered_from: "initial_framework",
      definition: "Transfer occurs reactively, after need arises",
      edge_count: 23
    },
    {
      category_id: "rushed",
      status: "emergent",
      first_observed: "2025-11-15",
      discovered_from: "discord_scrape_2025-11",
      definition: "Transfer compressed into insufficient time window",
      edge_count: 7
    }
  ],
  
  metadata: {
    created_at: "2025-09-01T00:00:00Z",
    last_modified: "2025-11-15T00:00:00Z",
    version: 2
  }
}
```

### Discord Event Schema

```javascript
{
  event_id: "discord_event_12345",
  message_id: "1234567890",  // Discord's message ID
  timestamp: "2025-11-17T09:15:00Z",
  
  // Author mapping
  author_discord_id: "discord_user_456",
  author_node_id: "PROVES.Ines",  // Mapped to system node
  author_university: "PROVES",
  
  // Channel mapping
  channel_id: "channel_789",
  channel_name: "cadence-proves-comms",
  mapped_edges: ["edge_456"],  // Which edge(s) this relates to
  
  // Content
  content_text: "Here's the protocol doc, sorry for the delay",
  attachments: [
    {
      filename: "protocol_v3.pdf",
      file_type: "pdf",
      size_bytes: 245000
    }
  ],
  
  // Interaction context
  is_reply: true,
  reply_to_message_id: "1234567889",
  mentions_discord_ids: ["discord_user_123"],
  mentions_node_ids: ["CADENCE.CommsRF.Lead"],
  reactions: [
    {emoji: "üëç", count: 2},
    {emoji: "üôè", count: 1}
  ],
  
  // Classification (auto or manual)
  tags: ["file_transfer", "late_delivery", "apology"],
  classification: {
    is_knowledge_transfer: true,
    transfer_type: "codified",  // codified | institutional | request | acknowledgment
    sentiment: "apologetic",
    urgency: "high",
    classified_by: "ai_auto",  // ai_auto | user_manual
    confidence: 0.85
  }
}
```

### University Schema

```javascript
{
  university_id: "CADENCE",
  display_name: "Cal Poly Pomona - CADENCE",
  timezone: "America/Los_Angeles",
  
  // Discord integration
  discord_server_id: "server_123",
  discord_channel_mappings: [
    {
      channel_id: "channel_456",
      channel_name: "avionics-team",
      maps_to_nodes: ["CADENCE.Avionics"]
    },
    {
      channel_id: "channel_789",
      channel_name: "cadence-proves-comms",
      maps_to_edges: ["edge_456"]
    }
  ],
  
  // Access control
  admin_users: ["user_001", "user_002"],
  member_users: ["user_003", "user_004", "user_005"],
  
  // Settings
  settings: {
    allow_cross_university_edges: true,
    require_approval_for_incoming_edges: false,
    auto_tag_discord_events: true
  },
  
  metadata: {
    joined_at: "2025-09-01T00:00:00Z",
    last_active: "2025-11-17T10:30:00Z"
  }
}
```

---

## System Components

### Component 1: Database Layer

**Purpose**: Persist all data with versioning and multi-tenant support

**Requirements**:
- Store nodes, edges, layers, categories, discord events, outcomes
- Support extensible schemas (new fields without migrations)
- Version tracking for edges as assessments evolve
- Multi-university partitioning with cross-university query capability
- Real-time subscriptions for live updates

**Technology options** (decide based on constraints):
- PostgreSQL + JSONB columns for extensible fields
- Supabase (PostgreSQL + real-time + auth)
- Firebase Firestore (real-time native, flexible schema)

### Component 2: Discord Bot

**Purpose**: Capture interaction data from university Discord servers

**Requirements**:
- Join multiple servers (8 universities)
- Read messages in designated channels
- Capture: content, author, timestamp, attachments, replies, reactions, mentions
- Map Discord users to system nodes
- Map channels to edges or node contexts
- Classify messages (knowledge transfer type, sentiment, urgency)
- Store events in database

**Technology options**:
- discord.js (Node.js)
- discord.py (Python)

### Component 3: Visualization Engine

**Purpose**: Render molecular structure with bidirectional data binding

**Requirements**:
- Display nodes as molecules with university-specific coloring
- Display edges as bonds with strength/risk visualization
- Cross-university edges visually distinct
- Drag nodes to reposition (persists to database)
- Drag from node to node to create edge (opens modal for configuration)
- Click edge to edit assessment
- Real-time updates when other users make changes
- Zoom, pan, filter by university/project/risk level

**Technology options**:
- Enhance current canvas-based approach
- D3.js for more sophisticated graph rendering
- Cytoscape.js for graph-specific features
- React Flow for node-based UI

### Component 4: Assessment Interface

**Purpose**: Allow users to assess edges across layers

**Requirements**:
- Display all layers for selected edge
- For each layer: select categories, set severity, add modifiers, record observations
- Support "other" / free-text for categories not yet in registry
- Flag emergent categories for researcher review
- Log outcomes (failure/success events) against edges
- Version each assessment change

### Component 5: Layer/Category Registry Manager

**Purpose**: Track and evolve the assessment schema

**Requirements**:
- View all layers and their categories
- Add new layers
- Add new categories to existing layers
- Promote categories from "emergent" to "provisional" to "established"
- Track which edges use each category
- Export schema for analysis

### Component 6: AI Learning Engine

**Purpose**: Learn coefficient weights from observed data

**Requirements**:
- Ingest edge characteristics (layer assessments) and outcomes
- Correlate characteristics with failure/success
- Update model weights
- Generate explainable reports (which variables changed, why)
- Propose updates for researcher approval (human-in-the-loop)
- Version models, allow rollback
- Compute risk scores for all edges using current model

**Technology options**:
- Bayesian regression (interpretable, handles uncertainty)
- Online learning algorithms
- LLM-assisted analysis for qualitative patterns

### Component 7: Dashboard Views

**Purpose**: Present data appropriately for different users

**Operations Mode** (per-university teams):
- Their university's nodes and edges
- Cross-university edges they're involved in
- Current risk scores and alerts
- Recent Discord activity
- Outcome logging interface

**Research Mode** (researcher):
- All universities' data
- Cross-university comparisons
- Model coefficient editor
- AI learning reports
- Schema evolution tools
- Pattern exploration

### Component 8: Authentication & Authorization

**Purpose**: Control access across 8 universities

**Requirements**:
- User accounts linked to universities
- Role hierarchy: admin, lead, member, viewer
- Cross-university edge permissions
- Research mode restricted to researcher account
- Consider Discord OAuth for seamless user mapping

---

## Integration Points

### Discord ‚Üî Database

```
Discord message ‚Üí Bot captures ‚Üí Classify ‚Üí Map to edge(s) ‚Üí Store event ‚Üí 
Update edge activity metrics ‚Üí Trigger visualization update
```

### Visualization ‚Üî Database

```
User drags node ‚Üí Capture new position ‚Üí Write to database ‚Üí 
Broadcast to other clients ‚Üí Other visualizations update
```

```
User creates edge via drag ‚Üí Modal for configuration ‚Üí 
Write edge to database ‚Üí Broadcast ‚Üí Visualizations update
```

### AI Engine ‚Üî Database

```
Scheduled job ‚Üí Read all edges with outcomes ‚Üí 
Train/update model ‚Üí Compute new risk scores ‚Üí 
Write to edge.computed ‚Üí Generate report ‚Üí 
Queue for researcher approval
```

### Cross-University Sync

```
University A creates edge to University B node ‚Üí 
Check permissions ‚Üí Write to database ‚Üí 
Notify University B users ‚Üí Appears in their dashboard
```

---

## The Iterative Discovery Process

This is the core research methodology. The system must support it natively.

### Phase 1: Initial Deployment

- Deploy with 6 NDA dimension layers + knowledge_type layer
- Provisional categories based on theory/literature
- Begin Discord data capture
- Users start assessing edges

### Phase 2: Pattern Observation

- Accumulate Discord events
- Users log outcomes (failures, successes)
- Researcher reviews raw_observations fields
- Notice patterns that don't fit current categories

### Phase 3: Category Emergence

- Researcher identifies new category (e.g., "rushed")
- Adds to registry with status "emergent"
- Applies to relevant edges
- System tracks edge_count

### Phase 4: Validation

- Observe if new category correlates with outcomes
- If predictive: promote to "provisional"
- If not: deprecate or merge with existing category

### Phase 5: Layer Discovery

- Notice that category appears across multiple dimensions
- Or: notice cluster of categories that share a pattern
- This may indicate a new layer
- Create layer, move/copy relevant categories

### Phase 6: Model Learning

- Once sufficient outcomes accumulated
- AI correlates characteristics with outcomes
- Weights adjust
- Risk predictions improve

### Repeat

The process is continuous. The schema evolves as long as the system is in use.

---

## Implementation Sequence

### Phase 1: Foundation (Do First)

**Goal**: Multi-university data model with persistence

1. Set up database with schemas defined above
2. Migrate from JS arrays to database reads/writes
3. Add university_id to all entities
4. Implement basic CRUD for nodes, edges
5. Add authentication with university association
6. Deploy, verify single-university functionality preserved

### Phase 2: Extensible Schema

**Goal**: Support dynamic layers and categories

1. Implement layer registry with category management
2. Modify edge schema to use extensible layers array
3. Build UI for assessing edges across layers
4. Support "other" / free-text in category selection
5. Track schema versions on edges

### Phase 3: Discord Integration

**Goal**: Capture real-time interaction data

1. Create Discord bot with multi-server support
2. Implement event capture and storage
3. Build user-to-node mapping interface
4. Build channel-to-edge mapping interface
5. Basic auto-classification (file transfers, mentions)
6. Display Discord activity in dashboard

### Phase 4: Bidirectional Visualization

**Goal**: Drag interactions modify data

1. Make node positions persistent
2. Implement drag-to-reposition with database write
3. Implement drag-to-create-edge gesture
4. Real-time sync across clients (WebSocket or polling)
5. Visual distinction for cross-university edges

### Phase 5: Outcome Tracking

**Goal**: Capture success/failure for AI learning

1. Build outcome logging UI on edges
2. Define outcome taxonomy (failure types, severity)
3. Link outcomes to specific edges
4. Display outcome history

### Phase 6: AI Learning Engine

**Goal**: Learn coefficients from data

1. Design model architecture (Bayesian, regression, or hybrid)
2. Build training pipeline from edges + outcomes
3. Implement risk score computation
4. Generate explainability reports
5. Build researcher approval interface
6. Model versioning and rollback

### Phase 7: Research Mode

**Goal**: Cross-university analysis tools

1. All-university view
2. Comparative analytics
3. Schema evolution dashboard
4. Model coefficient editor
5. Pattern exploration tools

### Phase 8: Scale and Polish

**Goal**: Production readiness for 8 universities

1. Performance optimization
2. Error handling and recovery
3. Onboarding flow for new universities
4. Documentation
5. Backup and disaster recovery

---

## Decision Points Requiring Human Input

The following decisions should be confirmed with Liz before implementation:

### Data & Infrastructure

1. **Database choice**: PostgreSQL, Supabase, Firebase, or other?
2. **Hosting**: Where will the system run?
3. **Authentication provider**: Discord OAuth, Google, custom?

### Discord Integration

4. **What defines a "knowledge transfer" message?**: NLP classification, manual tagging, channel-based assumption, or hybrid?
5. **Who maps users to nodes?**: Each university admin? Automated by Discord role?
6. **Which channels to monitor?**: All channels? Designated channels only?

### Permissions

7. **Cross-university edge creation**: Anyone can create? Requires approval from both sides? Only designated liaisons?
8. **Who can see what?**: Can University A see University B's full node lists or only shared edges?

### AI Learning

9. **Learning algorithm**: Bayesian updating, online regression, LLM-assisted, or hybrid?
10. **Update frequency**: Real-time, daily batch, weekly, on-demand?
11. **Human oversight level**: Approve all changes, approve only major changes, or autonomous?

### Visualization

12. **Graph layout algorithm**: Force-directed, hierarchical, manual-only, or hybrid?
13. **What does "drag to change data" mean beyond position?**: Can users drag to reassign team to project? Change bond type?

### Schema

14. **Initial severity scale**: Categorical (high/medium/low), numeric (1-5), probability (0-1)?
15. **Initial outcome taxonomy**: What are the failure types and success types?

---

## Technical Constraints

### Known Constraints

1. **8 universities**: System must handle 8 separate organizations with cross-references
2. **Real-time collaboration**: Multiple users viewing/editing simultaneously
3. **Research + Operations split**: Two distinct usage modes
4. **Schema evolution**: Cannot require code deployment to add categories/layers
5. **AI interpretability**: Researcher must understand why model changed

### Assumed Constraints (Verify)

1. **Browser-based**: Continuing with web application (not native app)
2. **Modern browsers**: Can use ES6+, WebSocket, modern CSS
3. **Internet required**: No offline mode needed
4. **English only**: No internationalization required

### Unknown Constraints (Ask)

1. **Budget**: Any cost constraints on infrastructure/services?
2. **Timeline**: Any deadlines for specific phases?
3. **Team**: Who else is implementing? Just you (agent) or others?
4. **Data sensitivity**: Any privacy/compliance requirements? (GDPR, IRB)

---

## Summary: Your Mandate

You are building a **research instrument** that:

1. Captures rich data about inter-university knowledge transfer interfaces
2. Supports iterative discovery of categories and layers through observation
3. Enables an embedded AI to learn what predicts interface failure
4. Provides operational dashboards for 8 universities
5. Provides research tools for schema evolution and model analysis

The **fixed elements** are:
- The matrix structure (nodes and directed edges)
- The 6 NDA diagnostic dimensions
- The institutional/codified knowledge risk distinction

The **discovered elements** are:
- Specific categories within each dimension
- Additional layers beyond the initial set
- Coefficient weights
- Interaction effects

Your job is to build the infrastructure that supports this discovery process, not to impose a final schema.

---

## First Action

After reading this briefing:

1. Review the existing `index.html` to understand current implementation
2. Identify the gap between current state and Phase 1 requirements
3. Propose a specific plan for Phase 1 (database setup, schema migration, multi-university support)
4. List which Decision Points you need answered before proceeding
5. Ask any clarifying questions

Do not begin coding until you have confirmed the plan with Liz.

---

## End of Briefing
